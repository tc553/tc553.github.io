let click=!0,clickButtonPressed=!1;function touchStarted(){click=!1,event.code="Touch",currentScene===sceneGame&&character.jump()}function mousePressed(){clickButtonPressed?clickButtonPressed=!1:click&&currentScene===sceneGame&&character.jump()}function keyPressed(){"ArrowUp"===key&&currentScene===sceneGame&&character.jump()}function preload(){imgScenario=loadImage("images/scenario/background.png"),imgCharacter=loadImage("images/character/stanley.png"),imgCharacterDead=loadImage("images/character/dead.png"),imgCharacterWin=loadImage("images/character/finished.png"),imgEnemyDwight=loadImage("images/enemies/dwight.png"),imgEnemyMichael=loadImage("images/enemies/michael.png"),imgEnemyFlyingMichael=loadImage("images/enemies/flying-michael.png"),imgEnemyJim=loadImage("images/enemies/jim.png"),imgEnemyAndy=loadImage("images/enemies/andy.png"),imgEnemyFlyingCreed=loadImage("images/enemies/flying-creed.png"),imgEnemyPam=loadImage("images/enemies/pam.png"),imgEnemyRyan=loadImage("images/enemies/ryan.png"),imgEnemyKelly=loadImage("images/enemies/kelly.png"),imgEnemyKevin=loadImage("images/enemies/kevin.png"),imgEnemyOscar=loadImage("images/enemies/oscar.png"),imgEnemyAngela=loadImage("images/enemies/angela.png"),imgEnemyFlyingPrisonMike=loadImage("images/enemies/flying-prison-mike.png"),imgEnemyJimAsDwight=loadImage("images/enemies/jim-dwight.png"),imgEnemyMeredith=loadImage("images/enemies/meredith.png"),imgEnemyToby=loadImage("images/enemies/toby.png"),imgEnemyFlyingPhyllis=loadImage("images/enemies/flying-phyllis.png"),imgFirstAid=loadImage("images/assets/first-aid.png"),imgFirstAidResponder=loadImage("images/assets/first-aid-responder.png"),imgPretzel=loadImage("images/assets/pretzel.gif"),imgCrossword=loadImage("images/assets/crossword.gif"),imgStressGreen=loadImage("images/assets/stress-01.gif"),imgStressYellow=loadImage("images/assets/stress-02.gif"),imgStressRed=loadImage("images/assets/stress-03.gif"),imgStressBomb=loadImage("images/assets/stress-bomb-gif.gif"),imgClock=loadImage("images/assets/clock.png"),imgClockBlinking=loadImage("images/assets/clock-blinking.gif"),imgDay=loadImage("images/assets/day.png"),jumpTheme=loadSound("sounds/jump.wav"),powerUpTheme=loadSound("sounds/powerup.wav"),failTheme=loadSound("sounds/fail.mp3"),deathTheme=loadSound("sounds/death.wav"),endTheme=loadSound("sounds/end.mp3"),firstAidTheme=loadSound("sounds/death-michael.mp3"),jumpTheme.setVolume(.7),powerUpTheme.setVolume(.1),failTheme.setVolume(.7),deathTheme.setVolume(.5),endTheme.setVolume(.5),firstAidTheme.setVolume(.5)}function setup(){createCanvas(canvasWidth,canvasHeight),resetGame(sceneMenu)}function clearGame(){scenario=null,character=null,pretzelsPositionMatrix=[],crosswordsPositionMatrix=[],firstAidResponder=null,enemies=[],powerUps=[],firstAidKit=null,score=null,life=null,startButton=null,resetButton=null,highScoresButton=null,sendScoreButton=null,nameInput=null,highScores=null,lastScore=null,mapTimerCount=0,gameStoppedTimerCount=0,scoreBoardTimerCount=0,mapIndex=0}function resetGame(a){clearGame(),currentScene=a,scenario=new Scenario(imgScenario,scenarioSpeed,imgScenarioWidth),character=new Character(stanleyPositionMatrix,imgCharacter,stanleyOffsetX,stanleyOffsetY,stanleyWidth,stanleyHeight,stanleyWidth,stanleyHeight,imgCharacterDead,imgCharacterWin),createEnemies(),createPowerUps(),firstAidResponder=new Enemy(firstAidResponderPositionMatrix,imgFirstAidResponder,width+300,5,firstAidResponderWidth,firstAidResponderHeight,firstAidResponderWidth,firstAidResponderHeight,10,200),score=new Score,life=new Life(imgFirstAid);let b=(windowWidth-canvasWidth)/2,c=(windowHeight-canvasHeight)/2;currentScene===sceneMenu&&(startButton=createImg(imgButtonPlay),startButton.addClass("imgButton").addClass("startButton")),pauseButton=createImg(imgButtonPause),pauseButton.addClass("imgButton").addClass("imgButtonSmall").addClass("pauseButton"),pauseButton.hide(),highScoresButton=createImg(imgButtonTrophy),highScoresButton.addClass("imgButton").addClass("highScoresButton"),highScoresButton.hide(),resumeButton=createImg(imgButtonPlay),resumeButton.addClass("imgButton"),resumeButton.hide(),resetButton=createImg(imgButtonRestart),resetButton.addClass("imgButton"),resetButton.hide(),homeButton=createImg(imgButtonHome),homeButton.addClass("imgButton").addClass("homeButton"),homeButton.hide(),sendScoreButton=createButton("Send score"),sendScoreButton.addClass("sendScoreButton"),sendScoreButton.hide(),nameInput=createInput().attribute("maxlength",10),nameInput.addClass("nameInput"),nameInput.hide(),highScoresButton.mousePressed(()=>{highScoresButton.remove(),startButton.remove(),homeButton.addClass("homeButtonFromScores"),homeButton.show(),readHighScores(5,!0)}),resumeButton.mousePressed(()=>{clickButtonPressed=!0,resetButton.hide(),resumeButton.hide(),homeButton.hide(),currentScene=sceneGame,loop()}),resetButton.mousePressed(()=>{clickButtonPressed=!0,resetButton.remove(),resumeButton.remove(),homeButton.remove(),pauseButton.remove(),highScoresButton.remove(),sendScoreButton.remove(),nameInput.remove(),resetGame(sceneGame),loop()}),homeButton.mousePressed(()=>{resetButton.remove(),resumeButton.remove(),homeButton.remove(),pauseButton.remove(),highScoresButton.remove(),sendScoreButton.remove(),nameInput.remove(),resetGame(sceneMenu),loop()}),readHighScores(5,!1);let d=localStorage.getItem("currentUserHighScoreV2");currentUserHighScore=JSON.parse(d),isGameStopped=!1,isGameOver=!1,isGameFinished=!1,isLevelFinished=!1,resetButtonVisible=!1,messageAllPretzels=new FloatingMessage("Pick up ALL pretzels to restore your first aid kit!",scenarioSpeed,590,105,270,65),messageDoubleJump=new FloatingMessage("Tap twice to double jump!",scenarioSpeed,1390,105,155,65),messageCrosswords=new FloatingMessage("Crosswords give +30 min and -50% stress level!",scenarioSpeed,2090,115,275,65),gameMessages=[],gameMessages.push(messageAllPretzels),gameMessages.push(messageDoubleJump),gameMessages.push(messageCrosswords),frameRate(30)}function readHighScores(a,b){readHighScoresFromDb(a).then(function(a){highScores=a,b&&(currentScene=sceneHighScores,isGameOver&&(homeButton.removeClass("homeButtonFromPause").addClass("homeButtonFromScores"),homeButton.show(),resetButton.addClass("resetButtonFromScores"),resetButton.show()))})}function createPowerUps(){buildPretzelsPositionMatrix(),pretzelsPositionMatrix.forEach(a=>{let b=new PowerUp(imgPretzel,a[0],a[1],scenarioSpeed,90,90,typePretzel);powerUps.push(b)}),buildCrosswordsPositionMatrix(),crosswordsPositionMatrix.forEach(a=>{let b=new PowerUp(imgCrossword,a[0],a[1],scenarioSpeed,90,90,typeCrossword);powerUps.push(b)}),firstAidKit=new PowerUp(imgFirstAid,-width,260,scenarioSpeed,60,50,typeFirstAid)}function createEnemies(){const a=new Enemy(dwightPositionMatrix,imgEnemyDwight,width,0,dwightWidth,dwightHeight,dwightWidth,dwightHeight,8,200),b=new Enemy(michaelPositionMatrix,imgEnemyMichael,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,12,150),c=new Enemy(flyingMichaelPositionMatrix,imgEnemyFlyingMichael,1.8*width,200,flyingMichaelWidth/1.5,flyingMichaelHeight/1.5,flyingMichaelWidth,michaelHeight,15,500),d=new Enemy(dwightPositionMatrix,imgEnemyJim,width,0,dwightWidth,dwightHeight,dwightWidth,dwightHeight,8,150),e=new Enemy(michaelPositionMatrix,imgEnemyAndy,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,12,100),f=new Enemy(flyingMichaelPositionMatrix,imgEnemyFlyingCreed,1.8*width,200,flyingMichaelWidth/1.5,flyingMichaelHeight/1.5,flyingMichaelWidth,michaelHeight,15,50),g=new Enemy(michaelPositionMatrix,imgEnemyPam,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,8,300),h=new Enemy(dwightPositionMatrix,imgEnemyRyan,width,0,dwightWidth,dwightHeight,dwightWidth,dwightHeight,12,100),i=new Enemy(michaelPositionMatrix,imgEnemyKelly,width+100,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,12,100),j=new Enemy(dwightPositionMatrix,imgEnemyKevin,width,0,dwightWidth,dwightHeight,dwightWidth,dwightHeight,8,100),k=new Enemy(michaelPositionMatrix,imgEnemyOscar,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,12,300),l=new Enemy(michaelPositionMatrix,imgEnemyAngela,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,15,500),m=new Enemy(flyingMichaelPositionMatrix,imgEnemyFlyingPrisonMike,1.8*width,200,flyingMichaelWidth/1.5,flyingMichaelHeight/1.5,flyingMichaelWidth,michaelHeight,15,200),n=new Enemy(michaelPositionMatrix,imgEnemyMeredith,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,8,300),o=new Enemy(dwightPositionMatrix,imgEnemyJimAsDwight,width,0,dwightWidth,dwightHeight,dwightWidth,dwightHeight,8,150),p=new Enemy(michaelPositionMatrix,imgEnemyToby,1.5*width,5,michaelWidth,michaelHeight,michaelWidth,michaelHeight,8,300),q=new Enemy(flyingMichaelPositionMatrix,imgEnemyFlyingPhyllis,1.8*width,200,flyingMichaelWidth/1.5,flyingMichaelHeight/1.5,flyingMichaelWidth,michaelHeight,15,200);enemies.push(j),enemies.push(e),enemies.push(n),enemies.push(g),enemies.push(p),enemies.push(a),enemies.push(k),enemies.push(q),enemies.push(d),enemies.push(h),enemies.push(i),enemies.push(o),enemies.push(l),enemies.push(f),enemies.push(b),enemies.push(m),enemies.push(c)}function draw(){currentScene===sceneMenu?drawMenu():currentScene===sceneHighScores?drawHighScores():currentScene===sceneGame?drawGame():currentScene===scenePause?(drawGame(),drawPauseMenu()):currentScene===sceneLevelEnd?(drawGame(),drawLevelEnd()):currentScene===sceneEnd?(drawGame(),drawEnd()):void 0}function stopGame(a){powerUps.forEach(a=>{a.stop()}),enemies.forEach(a=>{a.stop()}),a===typeDeath?(scenario.stop(),character.changeState(typeDeath),gameMessages.forEach(a=>{a.stop()}),!life.firstAidHasDecreased&&(isGameOver=life.decreaseFirstAid(),life.firstAidHasDecreased=!0,isGameOver?score.consolidateScore():score.increaseFirstAidOccurrences()),isGameStopped=!0,gameStoppedTimerCount++):a===typeLevelFinish&&(score.consolidateScore(),character.changeState(typeLevelFinish),!isLevelFinished&&endTheme.play(),isLevelFinished=!0)}function startNewLevel(){character.changeState(typeNormal),isLevelFinished=!1,score.scoreHasBeenConsolidated=!1,scoreBoardTimerCount=0,score.pretzels=0,score.crosswords=0,powerUps=[],firstAidKit=null,createPowerUps(),enemies=[],createEnemies()}function resumeGame(){life.resetBpm(),scenario.restart(),character.restart(),firstAidResponder.x=width,isGameStopped=!1,gameStoppedTimerCount=0,powerUps.forEach(a=>{a.restart()}),enemies.forEach(a=>{a.restart()}),gameMessages.forEach(a=>{a.restart()})}function isBusinessHours(){return!!(9<=score.scoreHour&&17>score.scoreHour)}function drawPauseMenu(){drawWhiteBoard(0);P5Style.titleStyle(),text("Game paused",width/2,1*height/6+35),homeButton.removeClass("homeButtonFromScores").addClass("homeButtonFromPause"),homeButton.show(),resetButton.addClass("resetButtonFromPause"),resetButton.show(),resumeButton.addClass("resumeButtonFromPause"),resumeButton.show(),noLoop()}function drawMenu(){scenario.display(),drawWhiteBoard(0);P5Style.titleStyle(),text("Stanley's Day At The Office",width/2,1*height/6+35);let a=1*height/6+45,b=a+20;P5Style.simpleTextStyle(),a=b,b=a+15,text("Avoid getting too close to your boss and your co-workers,\nor your stress level will increase!",140,b),a=b,b=a+35,text("Crossword puzzles reduce your stress and make time\ngo faster. Also, look up for delicious pretzels!",140,b),a=b,b=a+40,text("Use ArrowUp or Click/Tap to jump.",140,b),highScoresButton.show(),character.display(),startButton.mousePressed(()=>{clickButtonPressed=!0,startButton.remove(),resetButton.remove(),resumeButton.remove(),homeButton.remove(),pauseButton.remove(),highScoresButton.remove(),sendScoreButton.remove(),nameInput.remove(),resetGame(sceneGame)})}function drawHighScores(){scenario.display(),drawWhiteBoard(0);P5Style.titleStyle(),text("High Scores",width/2,1*height/6+35);let a=1*height/6+80;highScores.forEach(b=>{null!=lastScore&&b.docId===lastScore.docId?P5Style.redTextStyle():P5Style.simpleTextStyle(),textAlign(LEFT),text(highScores.indexOf(b)+1+". "+b.name,240,a),textAlign(RIGHT),text(b.totalScore,400,a),a+=20}),null!=lastScore&&null!=currentUserHighScore&&lastScore.docId===currentUserHighScore.docId?P5Style.redTextStyle():P5Style.simpleTextStyle(),a+=20,textAlign(LEFT),text("Your high score:",240,a),textAlign(RIGHT),null==currentUserHighScore?text(0,400,a):text(currentUserHighScore.totalScore,400,a),null!=lastScore&&(P5Style.redTextStyle(),a+=20,textAlign(LEFT),text("Your last score:",240,a),textAlign(RIGHT),text(lastScore.totalScore,400,a)),character.display()}function drawEnd(){scoreBoardTimerCount++;210>scoreBoardTimerCount?(170>scoreBoardTimerCount?offsetStep=0:offsetStep-=20,drawWhiteBoard(offsetStep),drawScoreBoard("Game Over!",offsetStep),animateScoreBoard()):(pauseButton.hide(),(null==lastScore||null==lastScore.docId)&&(lastScore=new HighScore(null,score.totalScore,score.scoreDay,score.scoreHour,score.scoreMinute,score.totalPretzels,score.totalCrosswords,score.totalDaysAllPretzelsPicked,score.totalFirstAidOccurrences,null)),null==currentUserHighScore||score.totalScore>currentUserHighScore.totalScore?(drawWhiteBoard(0),drawHighScoreInput(0)):readHighScores(5,!0)),character.display()}function drawLevelEnd(){scoreBoardTimerCount++;let a=!1;score.pretzels===pretzelQuantity&&life.firstAid<maxFirstAid&&(a=!0),220>scoreBoardTimerCount?(offsetStep=0,a&&(firstAidKit.x=width)):(offsetStep-=20,a&&(firstAidKit.display(),firstAidKit.move())),a&&character.isColliding(firstAidKit)&&!firstAidKit.picked&&(firstAidKit.getPicked(),life.increaseFirstAid()),drawWhiteBoard(offsetStep);let b="Day "+score.scoreDay+" Finished!";drawScoreBoard(b,offsetStep),animateScoreBoard(),animateNewLevelCountdown(),life.decreaseBpm(100),character.display(),isBusinessHours()&&(currentScene=sceneGame,startNewLevel())}function drawGame(){scenario.display(),scenario.move(),isGameOver||(pauseButton.show(),pauseButton.mousePressed(()=>{clickButtonPressed=!0,currentScene=scenePause})),null!=messageAllPretzels&&(messageAllPretzels.display(),messageAllPretzels.move(),messageAllPretzels.x<-messageAllPretzels.boxWidth&&(messageAllPretzels=null)),null!=messageDoubleJump&&(messageDoubleJump.display(),messageDoubleJump.move(),messageDoubleJump.x<-messageDoubleJump.boxWidth&&(messageDoubleJump=null)),null!=messageCrosswords&&(messageCrosswords.display(),messageCrosswords.move(),messageCrosswords.x<-messageCrosswords.boxWidth&&(messageCrosswords=null)),powerUps.forEach(a=>{a.display(),a.move(),character.isColliding(a)&&!a.picked&&(a.getPicked(),a.type===typePretzel?score.increasePretzels():a.type===typeCrossword&&(score.increaseCrosswords(),life.decreaseBpm(),score.fastForward(crosswordFastForwardMinutes)))}),character.display(),character.applyGravity(),17<=score.scoreHour&&(stopGame(typeLevelFinish),currentScene=sceneLevelEnd),life.bpm<life.maxBpm&&!isGameStopped&&(character.animate(),score.increaseScore());let a=(score.scoreDay+gameMap.length-1)%gameMap.length,b=gameMap[a].levelMap;mapIndex>=b.length&&(mapIndex=0);let c=b[mapIndex],d=c.enemies,e=d.map(function(a){return a.enemyId});if(enemies.filter(function(a){return e.includes(enemies.indexOf(a))}).forEach(a=>{if(a.display(),a.animate(),a.move(),isBusinessHours()){let b=d.filter(function(b){return b.enemyId===enemies.indexOf(a)})[0].speed;a.setSpeed(b),character.isColliding(a)&&!isGameStopped?(!a.hasCollided&&failTheme.play(),life.increaseBpm(),a.hasCollided=!0):a.hasCollided=!1}}),score.display(),life.display(),life.bpm>=life.maxBpm&&(stopGame(typeDeath),isGameOver?50<gameStoppedTimerCount&&(currentScene=sceneEnd):(firstAidResponder.display(),(firstAidResponder.x>character.x+70||100<gameStoppedTimerCount)&&(firstAidResponder.animate(),firstAidResponder.move()),120<gameStoppedTimerCount&&resumeGame())),mapTimerCount++,mapTimerCount>=c.duration){enemies.filter(function(a){return e.includes(enemies.indexOf(a))}).forEach(a=>{a.stop()});let a=enemies.filter(function(a){return e.includes(enemies.indexOf(a))}),b=a.filter(function(a){return a.x>-a.characterWidth}).length;0>=b&&(enemies.filter(function(a){return e.includes(enemies.indexOf(a))}).forEach(a=>{a.restart()}),mapTimerCount=0,mapIndex++)}}function drawWhiteBoard(a){fill(255,255,255,200),noStroke(),rect(1*width/8+a,1*height/8,3*width/4,3*height/4)}function drawScoreBoard(a,b){P5Style.titleStyle(),text(a,width/2+b,1*height/6+35);let c;c=isBusinessHours()?score.n(score.scoreHour)+"h"+score.n(score.scoreMinute):"17h00",image(imgClock,200+b,1*height/6+55,30,30),P5Style.clockCountStyle(),text(c,240+b,1*height/6+80),textAlign(RIGHT),text(score.scoreIncrementTime,430+b,1*height/6+80),image(imgPretzel,190+b,1*height/6+90,50,50),P5Style.pretzelCountStyle(),text(score.pretzels,240+b,1*height/6+120),textAlign(RIGHT),text(score.scoreIncrementPretzels,430+b,1*height/6+120),image(imgCrossword,190+b,1*height/6+125,50,50),P5Style.clockCountStyle(),text(score.crosswords,240+b,1*height/6+160),textAlign(RIGHT),text(score.scoreIncrementCrosswords,430+b,1*height/6+160),fill(103,130,133),noStroke(),rect(1*width/4+b,240,1*width/2,1*height/7,10),P5Style.clockCountStyle(),text("Total score:",190+b,1*height/6+215),textAlign(RIGHT),text(score.totalScore,430+b,1*height/6+215)}function animateScoreBoard(){30<scoreBoardTimerCount&&score.addTimeScoreToTotal(),75<scoreBoardTimerCount&&score.addPretzelScoreToTotal(),120<scoreBoardTimerCount&&score.addCrosswordScoreToTotal()}function drawHighScoreInput(a){P5Style.titleStyle(),text("New high score!",width/2+a,1*height/6+35),P5Style.clockCountStyle(),text("Total score:",185+a,1*height/6+90),textAlign(RIGHT),text(score.totalScore,430+a,1*height/6+90),fill(103,130,133),noStroke(),rect(1*width/4+a,177,1*width/2,1*height/7,10),P5Style.clockCountStyle(),text("Your name:",185+a,1*height/6+150),nameInput.show(),sendScoreButton.show(),sendScoreButton.mousePressed(()=>{let a=nameInput.value();nameInput.attribute("disabled",!0),sendScoreButton.attribute("disabled",!0);let b=null==currentUserHighScore||score.totalScore>currentUserHighScore.totalScore;b&&(currentUserHighScore=new HighScore(a,score.totalScore,score.scoreDay,score.scoreHour,score.scoreMinute,score.totalPretzels,score.totalCrosswords,score.totalDaysAllPretzelsPicked,score.totalFirstAidOccurrences,null)),function(a,c){addScoreToDb(a,c).then(function(a){nameInput.remove(),sendScoreButton.remove(),lastScore.setDocId(a.id),b&&currentUserHighScore.setDocId(a.id),localStorage.setItem("currentUserHighScoreV2",JSON.stringify(currentUserHighScore)),readHighScores(5,!0)})}(a,score)})}function animateNewLevelCountdown(){P5Style.titleLargeStyle(),5===score.scoreHour?text("Day "+(score.scoreDay+1)+" starting in...",width/2,1*height/6+35):6===score.scoreHour?text("3...",width/2,1*height/6+35):7===score.scoreHour?text("2...",width/2,1*height/6+35):8===score.scoreHour&&text("1...",width/2,1*height/6+35)}function buildPretzelsPositionMatrix(){var a=Math.floor;pretzelsPositionMatrix=[];let b=pretzelFirstXPostion;pretzelsPositionMatrix.push([b,pretzelYHigh]);for(let c=0;c<pretzelQuantity-1;c++){b+=100*a(random(1,11)),2e3===b||11e3===b?b+=100*a(random(1,11)):b>mapLength&&(b=mapLength-100*a(random(1,11)));let c,d=a(10*random());c=0==d%2?pretzelYHigh:pretzelYLow,pretzelsPositionMatrix.push([b,c])}}function buildCrosswordsPositionMatrix(){crosswordsPositionMatrix=[],crosswordsPositionMatrix.push([2e3,100]),crosswordsPositionMatrix.push([11e3,100])}